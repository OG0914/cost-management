# 更新说明：FOB深圳运费汇率配置

## 更新日期
2025-11-10

## 更新内容

### 1. 新增独立的运费汇率配置

在系统配置中新增了"FOB深圳运费汇率"配置项，与成本计算汇率分开管理。

**配置位置：** 系统配置管理 → FOB深圳运费汇率

**配置说明：**
- **配置键：** `fob_shenzhen_exchange_rate`
- **默认值：** 7.1
- **用途：** 用于计算整柜FOB深圳运费（人民币）= 运费（美金）× 运费汇率

### 2. 汇率区分

系统现在有两个独立的汇率配置：

| 配置项 | 用途 | 默认值 | 说明 |
|--------|------|--------|------|
| **汇率（CNY/USD）** | 成本计算 | 7.2 | 用于计算外销价：外销价 = 管销价 ÷ 汇率 |
| **FOB深圳运费汇率（USD/CNY）** | 运费计算 | 7.1 | 用于计算整柜FOB深圳运费：运费（人民币）= 运费（美金）× 运费汇率 |

### 3. 界面更新

#### 系统配置页面
新增"FOB深圳运费汇率"配置项，管理员可以独立修改。

#### 报价单新增页面
整柜FOB深圳运费计算明细中，"汇率"标签改为"运费汇率"，更清晰地表明其用途。

### 4. 技术实现

#### 数据库迁移
- 文件：`backend/db/migrations/007_add_fob_shenzhen_exchange_rate.sql`
- 内容：在 `system_config` 表中添加 `fob_shenzhen_exchange_rate` 配置项

#### 后端更新
- `backend/models/SystemConfig.js`：在 `getCalculatorConfig()` 方法中添加 `fobShenzhenExchangeRate` 字段

#### 前端更新
- `frontend/src/views/SystemConfig.vue`：新增运费汇率配置表单项
- `frontend/src/views/cost/CostAdd.vue`：
  - 从系统配置加载运费汇率
  - 使用配置的汇率计算整柜FOB深圳运费
  - 更新显示标签为"运费汇率"

## 使用说明

### 修改运费汇率

1. 进入"系统配置管理"页面
2. 找到"FOB深圳运费汇率"配置项
3. 修改数值（例如：7.1 → 7.2）
4. 点击"保存配置"
5. 新创建的报价单将使用新的运费汇率

### 注意事项

1. **历史报价单不受影响**：已创建的报价单保留创建时的汇率
2. **独立管理**：运费汇率与成本计算汇率互不影响
3. **实时生效**：修改后立即对新报价单生效
4. **权限要求**：只有管理员可以修改系统配置

## 示例

### 修改前
- 运费汇率：7.1（硬编码）
- 运费计算：$840 × 7.1 = ¥5964

### 修改后
- 运费汇率：7.2（可配置）
- 运费计算：$840 × 7.2 = ¥6048

## 优势

1. **灵活性**：运费汇率可以根据实际情况随时调整
2. **独立性**：运费汇率与成本计算汇率分开，互不干扰
3. **可维护性**：无需修改代码，通过界面即可调整
4. **可追溯性**：系统配置有更新时间记录

## 相关文件

- 数据库迁移：`backend/db/migrations/007_add_fob_shenzhen_exchange_rate.sql`
- 后端模型：`backend/models/SystemConfig.js`
- 系统配置页面：`frontend/src/views/SystemConfig.vue`
- 报价单新增页面：`frontend/src/views/cost/CostAdd.vue`
- 功能说明：`docs/整柜FOB深圳自动计算功能说明.md`
- 使用说明：`docs/FOB运费自动计算-使用说明.md`
