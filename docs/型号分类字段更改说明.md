# 型号分类字段更改说明

## 更改内容

将型号管理中的"备注"字段更改为"型号分类"，用于区分该型号属于口罩还是半面罩等类型。

## 修改的文件

### 1. 数据库迁移
- **backend/db/migrations/011_rename_model_remark_to_category.sql** - 数据库迁移SQL脚本（文档用）
- **backend/scripts/migrate-model-category.js** - 数据库迁移执行脚本
  - 添加新字段 `model_category`
  - 将原 `remark` 字段的数据复制到 `model_category`
  - 注意：由于SQLite限制，`remark`字段保留但不再使用

### 2. 后端代码
- **backend/models/Model.js**
  - `create()` 方法：`remark` → `model_category`
  - `update()` 方法：`remark` → `model_category`

- **backend/controllers/modelController.js**
  - `createModel()` 函数：参数 `remark` → `model_category`
  - `updateModel()` 函数：参数 `remark` → `model_category`
  - `importModels()` 函数：导入数据时使用 `model_category`

- **backend/utils/excelParser.js**
  - `parseModelExcel()` 方法：解析Excel时识别"型号分类"列

- **backend/utils/excelGenerator.js**
  - `generateModelExcel()` 方法：导出Excel时使用"型号分类"列
  - `generateModelTemplate()` 方法：模板中使用"型号分类"列

### 3. 前端代码
- **frontend/src/views/model/ModelManage.vue**
  - 表格列：`remark` → `model_category`，显示为"型号分类"
  - 表单字段：`remark` → `model_category`，标签为"型号分类"
  - 表单数据：`form.remark` → `form.model_category`
  - 输入提示：改为"请输入型号分类（如：口罩、半面罩）"

## 使用说明

### 执行迁移
```bash
node backend/scripts/migrate-model-category.js
```

### 字段用途
- **型号分类**：用于区分型号类型，如：
  - 口罩
  - 半面罩
  - 其他防护用品类型

### Excel导入导出
- 导入模板列名：法规类别、型号名称、型号分类
- 导出Excel列名：法规类别、型号名称、型号分类、状态、创建时间

## 注意事项

1. 由于SQLite不支持DROP COLUMN，原`remark`字段仍保留在数据库中，但应用代码已完全切换到使用`model_category`字段
2. 迁移脚本已将原`remark`字段的数据复制到`model_category`字段
3. 所有前后端代码已同步更新，确保一致性
4. Excel导入导出模板已同步更新

## 测试验证

已完成以下测试验证：

### 1. 数据库迁移测试 ✓
- 成功添加 `model_category` 字段
- 成功复制原 `remark` 字段数据
- 迁移了10条型号记录

### 2. Excel模板测试 ✓
- 下载模板包含正确的列：法规类别、型号名称、型号分类
- 示例数据显示"口罩"作为型号分类

### 3. Excel导入测试 ✓
- 成功解析包含"型号分类"列的Excel文件
- 正确识别中文列名"型号分类"和英文列名"model_category"
- 测试数据：
  - TEST-001 / 口罩 ✓
  - TEST-002 / 半面罩 ✓

### 4. 代码诊断 ✓
- 所有修改的文件无语法错误
- 前后端代码一致性验证通过

## 迁移日期
2024年12月2日
