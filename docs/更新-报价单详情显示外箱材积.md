# 更新说明 - 报价单详情显示外箱材积

## 更新日期
2025-11-09

## 更新内容

在报价单详情页面的包材明细表格中新增"外箱材积"列。

## 修改位置

### 1. 报价单新增/编辑页面
**文件：** `frontend/src/views/cost/CostAdd.vue`

**包材明细表格：**
- ✅ 已添加"外箱材积"列
- 显示格式：`1.5 立方英尺` 或 `-`

### 2. 报价单详情页面
**文件：** `frontend/src/views/cost/CostDetail.vue`

**包材明细表格：**
- ✅ 新增"外箱材积"列
- 显示格式：`1.5 立方英尺` 或 `-`

## 表格结构

### 修改前

| 序号 | 包材名称 | 基本用量 | 单价 | 小计 |
|------|---------|---------|------|------|
| 1 | 外箱 | 1 | ¥5.00 | ¥5.00 |
| 2 | 内袋 | 10 | ¥0.50 | ¥5.00 |

### 修改后

| 序号 | 包材名称 | 基本用量 | 单价 | **外箱材积** | 小计 |
|------|---------|---------|------|------------|------|
| 1 | 外箱 | 1 | ¥5.00 | **1.5** | ¥5.00 |
| 2 | 内袋 | 10 | ¥0.50 | **-** | ¥5.00 |

## 代码修改

### 前端修改

**文件：** `frontend/src/views/cost/CostDetail.vue`

```vue
<!-- 新增外箱材积列 -->
<el-table-column prop="carton_volume" label="外箱材积" width="120">
  <template #default="{ row }">
    <span v-if="row.carton_volume">{{ row.carton_volume }}</span>
    <span v-else style="color: #909399;">-</span>
  </template>
</el-table-column>
```

### 后端支持

**文件：** `backend/models/QuotationItem.js`

后端已支持返回外箱材积数据，通过关联`packaging_materials`表获取：

```javascript
// 关联 packaging_materials 表获取外箱材积
const stmt = db.prepare(`
  SELECT 
    qi.*,
    pm.carton_volume
  FROM quotation_items qi
  LEFT JOIN packaging_materials pm 
    ON pm.packaging_config_id = ? 
    AND pm.material_name = qi.item_name
  WHERE qi.quotation_id = ? AND qi.category = ?
  ORDER BY qi.id
`);
```

## 显示规则

1. **有外箱材积**：只显示数值
   - 示例：`1.5`

2. **无外箱材积**：显示"-"（灰色）
   - 适用于非外箱类包材（如内袋、标签等）

## 数据来源

外箱材积数据来自 `packaging_materials` 表的 `carton_volume` 字段。

**数据流程：**
1. 创建报价单时，从包装配置加载包材数据
2. 包材数据包含 `carton_volume` 字段
3. 保存到 `quotation_items` 表（通过item_name关联）
4. 查询时通过 `packaging_materials` 表关联获取
5. 前端显示在包材明细表格中

## 使用场景

### 1. 查看报价单详情
用户可以在报价单详情页面查看每个包材的外箱材积信息。

### 2. 核对包装信息
通过外箱材积可以核对包装配置是否正确。

### 3. 整柜运费计算
外箱材积用于整柜FOB深圳的数量自动计算。

## 影响范围

- ✅ 仅影响前端显示
- ✅ 不影响数据存储
- ✅ 不影响计算逻辑
- ✅ 向后兼容（旧数据显示"-"）

## 测试验证

### 测试场景1：有外箱材积的包材
1. 查看包含外箱的报价单详情
2. 验证外箱材积列显示正确的数值

### 测试场景2：无外箱材积的包材
1. 查看包含内袋、标签等包材的报价单详情
2. 验证外箱材积列显示"-"

### 测试场景3：混合包材
1. 查看同时包含外箱和其他包材的报价单详情
2. 验证外箱显示材积，其他包材显示"-"

## 部署说明

1. 前端代码已修改
2. 无需后端修改（已支持）
3. 无需数据库修改
4. 重新构建前端即可部署

## 相关功能

此更新与以下功能相关：
1. **整柜FOB深圳自动计算**：使用外箱材积计算可装箱数
2. **包装配置管理**：外箱材积在包装配置中维护
3. **报价单创建**：创建时加载外箱材积数据

## 文档更新

已创建/更新以下文档：
- ✅ `docs/更新-报价单详情显示外箱材积.md`（本文档）
- ✅ `docs/整柜FOB深圳自动计算功能说明.md`（相关功能）

---

**更新完成！** ✅
