# 系统配置页面 - 工价系数配置说明

## 访问路径
系统配置管理 → 工价系数

## 配置项位置
在系统配置页面中，工价系数配置项位于：
- 管销率
- 增值税率
- 保险率
- 汇率（CNY/USD）
- **工价系数** ← 新增配置项
- FOB深圳运费汇率
- 20尺整柜运费（美金）
- 40尺整柜运费（美金）
- 利润区间

## 配置项详情

### 字段名称
工价系数

### 默认值
1.56

### 输入类型
数字输入框（InputNumber）

### 取值范围
- 最小值：0.01
- 步长：0.01
- 精度：2位小数

### 提示信息
（默认 1.56）

## 使用说明

### 1. 查看当前配置
1. 以管理员身份登录系统
2. 点击左侧菜单"系统配置管理"
3. 在配置列表中找到"工价系数"
4. 当前值显示在输入框中

### 2. 修改配置
1. 点击"工价系数"输入框
2. 输入新的数值（例如：1.60）
3. 点击页面右上角的"保存配置"按钮
4. 等待保存成功提示

### 3. 验证修改
修改保存后，可以通过以下方式验证：
- 刷新页面，查看配置是否已更新
- 创建新的报价单，查看工序总价计算是否使用新系数
- 查看工序管理页面，工序总价显示是否使用新系数

## 配置说明

### 作用
工价系数用于计算工序总价：
```
工序总价 = 工序小计 × 工价系数
```

### 影响范围
修改工价系数会影响：
1. **工序管理页面**：工序总价显示
2. **报价单新增页面**：工序总计计算
3. **报价单详情页面**：工序总计显示
4. **成本计算**：基础成本价计算

### 生效时间
- 配置修改后立即生效
- 只影响新创建的报价单
- 不影响已创建的历史报价单

## 权限要求

### 查看权限
所有用户都可以查看系统配置

### 修改权限
只有管理员（admin）可以修改系统配置

### 非管理员访问
- 配置项显示为禁用状态（灰色）
- 无法修改配置值
- 不显示"保存配置"按钮

## 验证规则

### 必填验证
工价系数不能为空

### 数值验证
- 必须是正数（> 0）
- 必须是有效的数字格式
- 保留2位小数

### 保存前验证
点击"保存配置"时，系统会验证：
```javascript
if (configForm.process_coefficient <= 0) {
  ElMessage.error('工价系数必须大于 0');
  return;
}
```

## 配置示例

### 示例1：标准工价系数
```
工价系数：1.56
说明：默认配置，适用于大多数情况
```

### 示例2：调整后的工价系数
```
工价系数：1.65
说明：工价成本上涨后的调整值
```

### 示例3：降低工价系数
```
工价系数：1.50
说明：优化工艺流程后的降低值
```

## 常见问题

### Q1：修改配置后，历史报价单会更新吗？
A：不会。配置修改只影响新创建的报价单，历史报价单保留创建时的配置。

### Q2：如何知道当前使用的是哪个工价系数？
A：
- 在系统配置页面查看当前配置值
- 在报价单详情页面，工序总计会显示使用的系数
- 在工序管理页面，工序总价会显示使用的系数

### Q3：可以设置不同型号使用不同的工价系数吗？
A：当前版本不支持，所有型号使用统一的工价系数。如需此功能，请参考扩展建议。

### Q4：修改配置需要重启服务吗？
A：不需要。配置修改后立即生效，无需重启服务。

### Q5：如何恢复默认配置？
A：将工价系数改回 1.56，然后保存即可。

## 配置历史

### 查看配置更新时间
在系统配置页面底部，显示"最后更新时间"，可以查看配置的最后修改时间。

### 配置变更记录
当前版本不支持配置变更历史记录。如需此功能，可以：
1. 在数据库中查询 `system_config` 表的 `updated_at` 字段
2. 建议在修改配置时，在备注中记录变更原因

## 最佳实践

1. **修改前记录**：修改配置前，先记录当前值和修改原因
2. **小步调整**：建议每次调整幅度不超过 0.1
3. **测试验证**：修改后创建测试报价单验证计算结果
4. **通知相关人员**：配置变更后通知业务人员
5. **定期审查**：定期审查工价系数是否需要调整

## 技术细节

### 前端实现
```vue
<!-- 工价系数配置项 -->
<el-form-item label="工价系数">
  <el-input-number
    v-model="configForm.process_coefficient"
    :min="0.01"
    :step="0.01"
    :precision="2"
    style="width: 200px"
  />
  <span class="config-hint">（默认 1.56）</span>
</el-form-item>
```

### 数据存储
```sql
-- 数据库存储
SELECT * FROM system_config WHERE config_key = 'process_coefficient';
-- 结果：
-- config_key: process_coefficient
-- config_value: 1.56
-- description: 工价系数
```

### API接口
```bash
# 获取配置
GET /api/config

# 更新单个配置
PUT /api/config/process_coefficient

# 批量更新配置
POST /api/config/batch
```

## 相关文档

- [工价系数配置化-使用指南.md](./工价系数配置化-使用指南.md)
- [问题2修正-工价系数配置化.md](./问题2修正-工价系数配置化.md)
- [问题2修正-总结.md](./问题2修正-总结.md)
