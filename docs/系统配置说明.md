# 系统配置说明

## 配置位置

**路径：** 系统配置管理（Dashboard → 系统配置）

**权限：** 仅管理员可修改

## 配置项说明

### 1. 管销率（overhead_rate）

- **默认值：** 0.2（20%）
- **取值范围：** 0 到 1 之间的小数
- **用途：** 用于计算管销价
- **计算公式：** 管销价 = 成本价 ÷ (1 - 管销率)

**示例：**
- 成本价：¥100
- 管销率：0.2（20%）
- 管销价：¥100 ÷ (1 - 0.2) = ¥125

---

### 2. 增值税率（vat_rate）

- **默认值：** 0.13（13%）
- **取值范围：** 0 到 1 之间的小数
- **用途：** 用于计算内销价
- **计算公式：** 内销价 = 管销价 × (1 + 增值税率)

**示例：**
- 管销价：¥125
- 增值税率：0.13（13%）
- 内销价：¥125 × (1 + 0.13) = ¥141.25

---

### 3. 保险率（insurance_rate）

- **默认值：** 0.003（0.3%）
- **取值范围：** 0 到 1 之间的小数
- **用途：** 用于计算外销保险价
- **计算公式：** 保险价 = 外销价 × (1 + 保险率)

**示例：**
- 外销价：$15.00
- 保险率：0.003（0.3%）
- 保险价：$15.00 × (1 + 0.003) = $15.045

---

### 4. 汇率（exchange_rate）

- **默认值：** 7.2
- **取值范围：** 大于 0 的数值
- **用途：** 用于计算外销价（成本计算）
- **计算公式：** 外销价 = 管销价 ÷ 汇率
- **单位：** CNY/USD（人民币兑美元）

**示例：**
- 管销价：¥125
- 汇率：7.2
- 外销价：¥125 ÷ 7.2 = $17.36

**注意：** 此汇率用于成本计算，与FOB深圳运费汇率独立。

---

### 5. FOB深圳运费汇率（fob_shenzhen_exchange_rate）

- **默认值：** 7.1
- **取值范围：** 大于 0 的数值
- **用途：** 用于计算整柜FOB深圳运费
- **计算公式：** 运费（人民币）= 运费（美金）× 运费汇率
- **单位：** USD/CNY（美元兑人民币）

**示例：**
- 运费（美金）：$840
- 运费汇率：7.1
- 运费（人民币）：$840 × 7.1 = ¥5964

**注意：** 此汇率专门用于FOB深圳运费计算，与成本计算汇率独立。

---

### 6. 利润区间（profit_tiers）

- **默认值：** [0.05, 0.10, 0.25, 0.50]（5%, 10%, 25%, 50%）
- **取值范围：** 0 到 1 之间的小数数组
- **用途：** 用于生成利润区间报价
- **计算公式：** 报价 = 基础价 × (1 + 利润%)

**示例：**
- 基础价：$15.00
- 利润区间：[0.05, 0.10, 0.25, 0.50]
- 报价区间：
  - 5% 利润：$15.00 × 1.05 = $15.75
  - 10% 利润：$15.00 × 1.10 = $16.50
  - 25% 利润：$15.00 × 1.25 = $18.75
  - 50% 利润：$15.00 × 1.50 = $22.50

**操作：**
- 可以添加或删除利润档位
- 至少保留一个档位

---

## 汇率说明

系统有两个独立的汇率配置：

| 配置项 | 用途 | 默认值 | 单位 | 说明 |
|--------|------|--------|------|------|
| **汇率** | 成本计算 | 7.2 | CNY/USD | 人民币兑美元，用于计算外销价 |
| **FOB深圳运费汇率** | 运费计算 | 7.1 | USD/CNY | 美元兑人民币，用于计算运费 |

**为什么需要两个汇率？**

1. **用途不同**：
   - 成本计算汇率：用于产品定价（人民币 → 美元）
   - 运费汇率：用于运费结算（美元 → 人民币）

2. **方向相反**：
   - 成本计算：CNY/USD（除法）
   - 运费计算：USD/CNY（乘法）

3. **独立管理**：
   - 两个汇率可以根据不同的业务需求独立调整
   - 互不影响，更加灵活

---

## 配置修改

### 修改步骤

1. 进入"系统配置管理"页面
2. 修改需要调整的配置项
3. 点击"保存配置"按钮
4. 系统提示"配置保存成功"

### 注意事项

1. **权限要求**：只有管理员可以修改配置
2. **立即生效**：配置修改后立即对新报价单生效
3. **历史数据**：已创建的报价单保留创建时的配置参数
4. **定期更新**：建议定期更新汇率以反映实际汇率变化

---

## 配置验证

### 验证规则

- 管销率：0 ≤ 值 ≤ 1
- 增值税率：0 ≤ 值 ≤ 1
- 保险率：0 ≤ 值 ≤ 1
- 汇率：值 > 0
- FOB深圳运费汇率：值 > 0
- 利润区间：至少包含一个档位

### 错误提示

如果输入不符合规则，系统会显示相应的错误提示：
- "管销率必须在 0 到 1 之间"
- "增值税率必须在 0 到 1 之间"
- "保险率必须在 0 到 1 之间"
- "汇率必须大于 0"
- "至少需要一个利润档位"

---

## 技术说明

### 数据存储

- **表名：** `system_config`
- **存储格式：** 键值对（config_key, config_value）
- **数据类型：** 文本（JSON格式）

### API接口

- **获取配置：** `GET /api/config`
- **获取单个配置：** `GET /api/config/:key`
- **批量更新：** `POST /api/config/batch`

### 配置键名

```javascript
{
  overhead_rate: '0.2',
  vat_rate: '0.13',
  insurance_rate: '0.003',
  exchange_rate: '7.2',
  fob_shenzhen_exchange_rate: '7.1',
  profit_tiers: '[0.05, 0.10, 0.25, 0.50]'
}
```

---

## 常见问题

### Q1：修改配置后，历史报价单会受影响吗？

A：不会。已创建的报价单保留创建时的配置参数，不受后续配置修改的影响。

### Q2：为什么有两个汇率？

A：成本计算汇率用于产品定价（CNY→USD），运费汇率用于运费结算（USD→CNY），两者用途和方向不同，需要独立管理。

### Q3：如何知道配置最后更新时间？

A：在系统配置页面底部显示"最后更新时间"。

### Q4：非管理员可以查看配置吗？

A：可以查看，但不能修改。只有管理员有修改权限。

### Q5：配置修改后需要重启系统吗？

A：不需要。配置修改后立即生效。

---

## 更新日志

- **2025-11-10**：新增FOB深圳运费汇率配置项
- **2025-11-09**：初始版本，包含基础配置项
