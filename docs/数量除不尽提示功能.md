# 数量除不尽提示功能

## 功能说明

在新增或复制报价单时，当用户输入的数量无法被包装配置整除时，系统会自动提示用户更准确的数量，以便后续运费计算更加精确。

## 使用场景

**示例：**
- 包装配置：1pc/bag, 1bags/box, 24boxes/carton
- 每箱只数：1 × 1 × 24 = 24pcs/carton
- 用户输入数量：2000pcs
- 实际箱数：2000 ÷ 24 = 83.33箱（向上取整为 84箱）
- 建议数量：84 × 24 = 2016pcs

## 实现逻辑

### 1. 计算流程

在 `calculateShippingInfo()` 函数中：

1. 计算精确箱数：`exactCartons = quantity / pcsPerCarton`
2. 向上取整得到实际箱数：`cartons = Math.ceil(exactCartons)`
3. 比较精确值和取整值：
   - 如果相等：数量刚好整除，无需提示
   - 如果不等：数量除不尽，显示警告提示

### 2. 提示信息

当检测到数量除不尽时，系统会显示包含以下信息的警告提示：

- 当前输入的数量
- 包装配置详情（pc/bag, bags/box, boxes/carton）
- 建议的准确数量
- 计算说明（箱数 × 每箱只数）

### 3. 提示样式

- 类型：警告（warning）
- 持续时间：8秒
- 可手动关闭
- 多行显示，便于阅读

## 代码实现

```javascript
// 计算箱数（精确值）
const exactCartons = form.quantity / shippingInfo.pcsPerCarton
const cartons = Math.ceil(exactCartons)
shippingInfo.cartons = cartons

// 检查是否除不尽
if (exactCartons !== cartons) {
  // 计算建议的准确数量
  const suggestedQuantity = cartons * shippingInfo.pcsPerCarton
  
  // 获取包装配置信息
  const selectedConfig = packagingConfigs.value.find(c => c.id === form.packaging_config_id)
  let packagingInfo = ''
  if (selectedConfig) {
    packagingInfo = `${selectedConfig.pc_per_bag}pc/bag, ${selectedConfig.bags_per_box}bags/box, ${selectedConfig.boxes_per_carton}boxes/carton`
  }
  
  // 显示警告提示
  ElMessage.warning({
    message: `当前数量 ${form.quantity} 除不尽！\n包装配置：${packagingInfo}\n建议数量为 ${suggestedQuantity}pcs（${cartons}箱 × ${shippingInfo.pcsPerCarton}pcs/箱），这样后续运费计算会更准确。`,
    duration: 8000,
    showClose: true
  })
}
```

## 触发时机

该提示会在以下情况下触发：

1. 用户手动修改购买数量时（`onQuantityChange`）
2. 选择或更改包装配置时（`onPackagingConfigChange`）
3. 加载报价单数据后重新计算时（编辑或复制模式）

## 用户体验

### 优点

1. **及时提醒**：在用户输入数量后立即提示，避免后续计算误差
2. **信息完整**：提供包装配置和建议数量，用户可以快速了解情况
3. **不强制修改**：仅提示建议，不强制用户修改数量，保持灵活性
4. **计算准确**：即使用户不修改，系统仍会按向上取整的箱数计算运费

### 注意事项

1. 提示仅为建议，用户可以选择保持原数量或修改为建议数量
2. 系统会按照向上取整后的箱数计算运费和材积
3. 建议数量总是大于或等于用户输入的数量

## 相关文件

- **前端页面**：`frontend/src/views/cost/CostAdd.vue`
- **计算函数**：`calculateShippingInfo()`
- **触发函数**：`onQuantityChange()`, `onPackagingConfigChange()`

## 测试建议

### 测试用例 1：数量整除
- 包装配置：24pcs/carton
- 输入数量：2400
- 预期结果：无提示（2400 ÷ 24 = 100箱，整除）

### 测试用例 2：数量除不尽
- 包装配置：24pcs/carton
- 输入数量：2000
- 预期结果：显示提示，建议数量为 2016pcs（84箱）

### 测试用例 3：数量除不尽（小数）
- 包装配置：36pcs/carton
- 输入数量：1000
- 预期结果：显示提示，建议数量为 1008pcs（28箱）

## 后续优化建议

1. **可选自动修正**：在提示中添加"自动修正"按钮，点击后自动将数量修改为建议值
2. **高亮显示**：在数量输入框旁边显示建议数量，方便用户对比
3. **历史记录**：记录用户常用的数量，提供快速选择
4. **批量验证**：在提交前统一检查所有报价单的数量是否整除

## 更新日期

2024-11-30
