# 更新：40尺和20尺整柜分离

## 更新日期
2025-11-13

## 更新内容

将原来的"整柜"选项分离为"40尺整柜"和"20尺整柜"两个独立选项，以支持不同规格的集装箱运输。

## 功能说明

### 1. 货运方式选项

在新增报价单页面，外销类型下的货运方式现在包含三个选项：

- **40尺整柜**（FCL 40'）
- **20尺整柜**（FCL 20'）
- **散货**（LCL）

### 2. 计算参数对比

| 货运方式 | 容积（立方英尺） | 运费（美金） | 运费汇率 | 运费（人民币） |
|---------|----------------|-------------|---------|---------------|
| 40尺整柜 | 1950 | $940 | 7.1 | ¥6674 |
| 20尺整柜 | 950 | $840 | 7.1 | ¥5964 |
| 散货 | - | 根据CBM计算 | - | ¥2310-¥4880 |

### 3. 自动计算逻辑

#### 40尺整柜
```
可装箱数 = 1950 ÷ 单箱材积（向上取整）
建议数量 = 可装箱数 × 每箱只数
运费总计 = $940 × 7.1 = ¥6674
```

#### 20尺整柜
```
可装箱数 = 950 ÷ 单箱材积（向上取整）
建议数量 = 可装箱数 × 每箱只数
运费总计 = $840 × 7.1 = ¥5964
```

## 使用示例

### 示例1：40尺整柜

**包装配置：**
- 单箱材积：1.5立方英尺
- 每箱只数：120pcs

**计算过程：**
```
可装箱数 = 1950 ÷ 1.5 = 1300箱
建议数量 = 1300 × 120 = 156,000pcs
运费总计 = $940 × 7.1 = ¥6674
```

### 示例2：20尺整柜

**包装配置：**
- 单箱材积：1.5立方英尺
- 每箱只数：120pcs

**计算过程：**
```
可装箱数 = 950 ÷ 1.5 = 634箱（向上取整）
建议数量 = 634 × 120 = 76,080pcs
运费总计 = $840 × 7.1 = ¥5964
```

## 界面变化

### 货运方式选择

**修改前：**
```
○ 整柜  ○ 散货
```

**修改后：**
```
○ 40尺整柜  ○ 20尺整柜  ○ 散货
```

### 数量提示

**40尺整柜：**
```
40尺整柜FOB深圳自动计算数量：1950÷单箱材积×每箱只数
```

**20尺整柜：**
```
20尺整柜FOB深圳自动计算数量：950÷单箱材积×每箱只数
```

### 运费计算明细标题

**40尺整柜：**
```
FOB深圳运费计算明细（40尺整柜）
```

**20尺整柜：**
```
FOB深圳运费计算明细（20尺整柜）
```

## 技术实现

### 1. 前端修改

**文件：** `frontend/src/views/cost/CostAdd.vue`

- 货运方式选项从 `fcl` 分离为 `fcl_40` 和 `fcl_20`
- 根据选择的货运方式使用不同的容积和运费参数
- 更新界面显示文本

**文件：** `frontend/src/views/cost/CostDetail.vue`

- 更新货运方式显示逻辑，支持显示"40尺整柜"和"20尺整柜"

### 2. 后端修改

**文件：** `backend/db/migrations/008_update_shipping_method_constraint.sql`

- 更新数据库约束，允许 `shipping_method` 字段存储 `fcl_40` 和 `fcl_20`
- 原有的 `fcl` 值仍然保留，用于兼容历史数据

### 3. 数据库约束

```sql
shipping_method TEXT CHECK(
  shipping_method IN ('fcl', 'fcl_20', 'fcl_40', 'lcl') 
  OR shipping_method IS NULL
)
```

## 兼容性说明

### 历史数据

- 原有的 `fcl` 值仍然有效，在详情页面会显示为"整柜"
- 新创建的报价单必须选择"40尺整柜"或"20尺整柜"

### 数据迁移

- 无需手动迁移历史数据
- 历史报价单的 `fcl` 值会被正确识别和显示

## 使用场景

### 何时选择40尺整柜？

- 订单量大，需要更大的装载容量
- 单位运费成本更低（$940 vs $840，但容积翻倍）
- 适合大批量出口订单

### 何时选择20尺整柜？

- 订单量适中
- 标准集装箱运输
- 适合中等批量出口订单

### 何时选择散货？

- 订单量较小（CBM < 15）
- 不需要整柜运输
- 运费根据实际CBM计算

## 注意事项

1. **容积差异**：40尺整柜容积（1950立方英尺）是20尺整柜（950立方英尺）的2倍多
2. **运费差异**：40尺整柜运费（$940）比20尺整柜（$840）高$100
3. **成本效益**：40尺整柜的单位运费成本更低，适合大批量订单
4. **自动计算**：选择整柜后，数量会自动计算并锁定，无需手动输入

## 相关文档

- [整柜FOB深圳自动计算功能说明](./整柜FOB深圳自动计算功能说明.md)
- [FOB运费自动计算-使用说明](./FOB运费自动计算-使用说明.md)
- [更新-FOB深圳运费汇率配置](./更新-FOB深圳运费汇率配置.md)
- [更新-可装箱数向上取整](./更新-可装箱数向上取整.md)
