# 测试：40尺和20尺整柜功能

## 测试日期
2025-11-13

## 测试目标
验证40尺整柜和20尺整柜功能是否正常工作

## 测试环境
- 前端：Vue 3 + Element Plus
- 后端：Node.js + SQLite
- 数据库迁移：已执行 008_update_shipping_method_constraint.sql

## 测试用例

### 用例1：新增报价单 - 40尺整柜

**前置条件：**
- 已登录系统
- 已有法规类别和包装配置数据
- 包装配置包含外箱材积数据

**测试步骤：**
1. 进入"新增报价单"页面
2. 选择法规类别和型号配置
3. 填写客户名称和地区
4. 选择"外销"
5. 选择"40尺整柜"
6. 选择"FOB深圳"

**预期结果：**
- ✅ 货运方式显示三个选项：40尺整柜、20尺整柜、散货
- ✅ 选择40尺整柜后，数量自动计算并锁定
- ✅ 提示文本显示：40尺整柜FOB深圳自动计算数量：1950÷单箱材积×每箱只数
- ✅ 运费计算明细标题显示：FOB深圳运费计算明细（40尺整柜）
- ✅ 可装箱数 = 1950 ÷ 单箱材积（向上取整）
- ✅ 运费（美金）= $940
- ✅ 运费总计 = $940 × 7.1 = ¥6674

### 用例2：新增报价单 - 20尺整柜

**测试步骤：**
1. 进入"新增报价单"页面
2. 选择法规类别和型号配置
3. 填写客户名称和地区
4. 选择"外销"
5. 选择"20尺整柜"
6. 选择"FOB深圳"

**预期结果：**
- ✅ 选择20尺整柜后，数量自动计算并锁定
- ✅ 提示文本显示：20尺整柜FOB深圳自动计算数量：950÷单箱材积×每箱只数
- ✅ 运费计算明细标题显示：FOB深圳运费计算明细（20尺整柜）
- ✅ 可装箱数 = 950 ÷ 单箱材积（向上取整）
- ✅ 运费（美金）= $840
- ✅ 运费总计 = $840 × 7.1 = ¥5964

### 用例3：新增报价单 - 散货

**测试步骤：**
1. 进入"新增报价单"页面
2. 选择法规类别和型号配置
3. 填写客户名称和地区
4. 选择"外销"
5. 选择"散货"
6. 选择"FOB深圳"
7. 手动输入数量

**预期结果：**
- ✅ 数量字段可编辑
- ✅ 运费根据CBM自动计算
- ✅ 运费计算明细标题显示：FOB深圳运费计算明细（散货）

### 用例4：报价单详情页面显示

**测试步骤：**
1. 创建一个40尺整柜的报价单
2. 保存并查看详情

**预期结果：**
- ✅ 货运方式显示：40尺整柜

**测试步骤：**
1. 创建一个20尺整柜的报价单
2. 保存并查看详情

**预期结果：**
- ✅ 货运方式显示：20尺整柜

### 用例5：历史数据兼容性

**测试步骤：**
1. 查看旧的报价单（shipping_method = 'fcl'）

**预期结果：**
- ✅ 货运方式显示：整柜
- ✅ 数据正常显示，无错误

### 用例6：数据库约束验证

**测试步骤：**
1. 尝试保存报价单，shipping_method 为 'fcl_40'
2. 尝试保存报价单，shipping_method 为 'fcl_20'
3. 尝试保存报价单，shipping_method 为 'lcl'

**预期结果：**
- ✅ 所有值都能正常保存
- ✅ 数据库不报错

## 测试数据示例

### 包装配置
- 单箱材积：1.5立方英尺
- 每箱只数：120pcs（10pc/bag × 12bags/box × 1box/carton）

### 40尺整柜计算结果
```
可装箱数 = 1950 ÷ 1.5 = 1300箱
建议数量 = 1300 × 120 = 156,000pcs
运费总计 = $940 × 7.1 = ¥6674
```

### 20尺整柜计算结果
```
可装箱数 = 950 ÷ 1.5 = 634箱（向上取整）
建议数量 = 634 × 120 = 76,080pcs
运费总计 = $840 × 7.1 = ¥5964
```

## 注意事项

1. 确保包装配置中有外箱材积数据
2. 确保系统配置中的FOB深圳运费汇率已设置（默认7.1）
3. 测试时注意观察数量字段是否正确锁定
4. 测试时注意观察运费是否正确计算

## 回归测试

- ✅ 内销功能正常
- ✅ 其他港口功能正常
- ✅ 散货功能正常
- ✅ 原料、工序、包材明细功能正常
- ✅ 成本计算功能正常
- ✅ 保存草稿功能正常
- ✅ 提交审核功能正常

## 测试结论

所有功能按预期工作，40尺整柜和20尺整柜功能已成功实现。
