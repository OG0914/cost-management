---
name: superpowers-code-review
description: 请求代码审查。完成任务、实现主要功能或合并前使用，验证工作是否满足需求。
---

# 请求代码审查

在问题级联前捕获它们。

**核心原则：** 早审查，常审查。

## 何时请求审查

**必须：**
- 每个任务完成后（子代理驱动开发中）
- 完成主要功能后
- 合并到main前

**可选但有价值：**
- 卡住时（新视角）
- 重构前（基线检查）
- 修复复杂Bug后

## 如何请求

**1. 获取git SHA：**
```bash
BASE_SHA=$(git rev-parse HEAD~1)  # 或 origin/main
HEAD_SHA=$(git rev-parse HEAD)
```

**2. 审查清单：**

```markdown
## 代码审查请求

**实现内容：** [你刚构建了什么]
**需求/计划：** [应该做什么]
**提交范围：** BASE_SHA..HEAD_SHA

### 审查要点

1. **规范合规性**
   - [ ] 代码是否实现了规范中的所有需求？
   - [ ] 是否有超出规范的额外实现？
   - [ ] 是否有遗漏的需求？

2. **代码质量**
   - [ ] 代码结构清晰吗？
   - [ ] 命名是否有意义？
   - [ ] 是否有重复代码？
   - [ ] 错误处理是否完善？

3. **测试覆盖**
   - [ ] 关键路径有测试吗？
   - [ ] 边界情况有覆盖吗？
   - [ ] 测试是否有意义（不只是为了覆盖率）？

4. **性能考虑**
   - [ ] 有N+1查询问题吗？
   - [ ] 有不必要的循环吗？
   - [ ] 大数据量处理是否合理？

5. **安全性**
   - [ ] 输入是否验证？
   - [ ] 是否有SQL注入风险？
   - [ ] 敏感数据是否保护？
```

**3. 根据反馈行动：**
- 立即修复 Critical 问题
- 在继续前修复 Important 问题
- 记录 Minor 问题以后处理
- 如果审查者错了，用理由反驳

## 问题严重级别

| 级别 | 描述 | 行动 |
|------|------|------|
| Critical | 阻塞问题，安全漏洞，数据丢失风险 | 立即修复，不能继续 |
| Important | 逻辑错误，缺失验证，性能问题 | 继续前修复 |
| Minor | 代码风格，命名改进，小优化 | 记录，以后处理 |
| Nitpick | 个人偏好，可选改进 | 酌情处理 |

## 示例

```
[刚完成任务2: 添加验证函数]

让我在继续前请求代码审查。

$ git log --oneline -3
3df7661 feat: add verifyIndex and repairIndex functions
a7981ec feat: add index structure
f892341 initial setup

审查范围: a7981ec..3df7661

## 审查请求

**实现内容：** 对话索引的验证和修复功能
**需求：** docs/plans/deployment-plan.md 的任务2
**变更：** verifyIndex() 和 repairIndex()，4种问题类型

### 自检结果

- [x] 实现了规范的所有需求
- [x] 没有超出规范的额外实现
- [x] 关键路径有测试
- [x] 错误处理完善

请审查。
```

## 红旗

**绝不：**
- 因为"很简单"跳过审查
- 忽略 Critical 问题
- 带着未修复的 Important 问题继续
- 对有效的技术反馈争辩

**如果审查者错了：**
- 用技术理由反驳
- 展示证明它工作的代码/测试
- 请求澄清

## 接收审查反馈

接收代码审查需要技术评估，不是情绪表演。

**禁止的回应：**
- "你完全正确！"（表演性）
- "好观点！" / "很棒的反馈！"（表演性）
- "让我现在就实现"（验证前）

**正确的回应：**
- 重述技术需求
- 问澄清问题
- 如果错了用技术理由反驳
- 直接开始修复（行动 > 言语）

**处理不清楚的反馈：**
```
如果任何项不清楚：
  停止 - 还不要实现任何东西
  询问不清楚项的澄清

为什么：项可能相关。部分理解 = 错误实现。
```

**承认正确的反馈：**
```
✅ "已修复。[简述改了什么]"
✅ "好发现 - [具体问题]。已在[位置]修复。"
✅ [直接修复并在代码中展示]

❌ "你完全正确！"
❌ "好观点！"
❌ 任何感谢表达
```
