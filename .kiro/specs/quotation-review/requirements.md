# 报价单审核流程 - 需求文档

## 项目简介

本功能旨在补全成本分析管理系统的审核流程，实现报价单的状态流转、差异高亮、批注功能和审核记录追溯。系统已预留数据库字段和基础API，本次开发将完成前端审核页面和后端审核逻辑的完整实现。

## 术语表

- **报价单(Quotation)**：业务员创建的成本报价记录
- **审核人(Reviewer)**：具有审核权限的用户角色
- **管理员(Admin)**：具有最高权限的用户角色，可执行删除操作
- **业务员(Salesperson)**：创建和编辑报价单的用户角色
- **差异高亮(Difference Highlight)**：标记业务员修改过的数据项
- **批注(Comment)**：审核人对报价单添加的备注信息
- **标准配置(Standard Config)**：包装配置关联的标准原料、工序、包材数据
- **利润报价(Profit Pricing)**：基于成本价按不同利润率（5%、10%、25%、50%等）计算的报价
- **待审核记录**：状态为"已提交"的报价单列表页面
- **已审核记录**：状态为"已通过"或"已退回"的报价单列表页面

## 需求列表

### 需求 1：待审核记录页面

**用户故事：** 作为审核人，我希望能够查看所有待审核的报价单列表，以便快速了解审核工作量并选择报价单进行审核。

#### 验收标准

1. WHEN 审核人访问待审核记录页面 THEN 系统 SHALL 仅显示状态为"已提交"的报价单列表
2. WHEN 审核人查看列表 THEN 系统 SHALL 显示报价单编号、状态、类型、客户名称、型号、数量、最终价格、创建人、提交时间
3. WHEN 审核人点击筛选 THEN 系统 SHALL 支持按客户名称、型号、提交日期范围筛选
4. WHEN 审核人点击[审核]按钮 THEN 系统 SHALL 以弹窗形式打开待审核详情页面
5. WHEN 管理员查看列表 THEN 系统 SHALL 显示[删除]按钮，仅管理员可操作
6. WHEN 列表数据超过分页阈值 THEN 系统 SHALL 提供分页功能

### 需求 2：已审核记录页面

**用户故事：** 作为审核人，我希望能够查看所有已审核的报价单列表，以便追溯审核历史。

#### 验收标准

1. WHEN 审核人访问已审核记录页面 THEN 系统 SHALL 显示状态为"已通过"或"已退回"的报价单列表
2. WHEN 审核人查看列表 THEN 系统 SHALL 显示报价单编号、状态、类型、客户名称、型号、数量、最终价格、审核人、审核时间
3. WHEN 状态为"已通过" THEN 系统 SHALL 显示绿色状态标签
4. WHEN 状态为"已退回" THEN 系统 SHALL 显示红色状态标签
5. WHEN 审核人点击筛选 THEN 系统 SHALL 支持按状态（已通过/已退回）、客户名称、型号、审核日期范围筛选
6. WHEN 审核人点击[查看]按钮 THEN 系统 SHALL 以弹窗形式打开已审核详情页面
7. WHEN 管理员查看列表 THEN 系统 SHALL 显示[删除]按钮，仅管理员可操作

### 需求 3：待审核详情页面（审核操作）

**用户故事：** 作为审核人，我希望能够查看报价单详情并清晰看到业务员修改的内容，以便准确判断报价是否合理并执行审核操作。

#### 验收标准

1. WHEN 审核人打开待审核详情页面 THEN 系统 SHALL 以弹窗形式显示，右上角有X关闭按钮
2. WHEN 审核人查看基本信息 THEN 系统 SHALL 显示审核状态、销售类型、客户名称、客户地区、法规类别、产品型号、包装配置、订单数量、创建人员、提交时间
3. WHEN 审核人查看成本明细 THEN 系统 SHALL 显示原料、工序、包材三个Tab分类的完整明细
4. WHEN 报价单明细项被业务员修改过 THEN 系统 SHALL 使用浅蓝色背景高亮显示该行，并显示标准值对比
5. WHEN 报价单明细项为新增项 THEN 系统 SHALL 使用浅绿色背景高亮显示该行
6. WHEN 审核人查看价格汇总 THEN 系统 SHALL 显示成本价、管销价、外销价及利润报价（5%、10%、25%、50%）
7. WHEN 审核人点击[通过]或[退回]按钮 THEN 系统 SHALL 在页面底部居中显示这两个按钮
8. WHEN 待审核详情页面显示时 THEN 系统 SHALL 不显示审核历史（因为尚未审核）

### 需求 4：审核通过操作

**用户故事：** 作为审核人，我希望能够对报价单执行通过操作，以便完成审核流程。

#### 验收标准

1. WHEN 审核人点击[通过]按钮 THEN 系统 SHALL 弹出通过确认弹窗
2. WHEN 通过弹窗显示 THEN 系统 SHALL 显示客户名称、客户地区、销售类型、产品型号、订单数量、最终价格、利润区间报价
3. WHEN 通过弹窗显示 THEN 系统 SHALL 提供可选的审核批注输入框
4. WHEN 通过弹窗按钮显示 THEN 系统 SHALL 将[取消]和[确认通过]按钮居中显示
5. WHEN 审核人确认通过 THEN 系统 SHALL 将报价单状态更改为"已通过"
6. WHEN 报价单审核通过 THEN 系统 SHALL 记录审核人ID和审核时间

### 需求 5：审核退回操作

**用户故事：** 作为审核人，我希望能够对报价单执行退回操作，以便通知业务员修改问题。

#### 验收标准

1. WHEN 审核人点击[退回]按钮 THEN 系统 SHALL 弹出退回确认弹窗
2. WHEN 退回弹窗显示 THEN 系统 SHALL 显示客户名称、客户地区、销售类型、产品型号、订单数量、最终价格、利润区间报价
3. WHEN 退回弹窗显示 THEN 系统 SHALL 提供必填的退回原因输入框
4. WHEN 退回弹窗按钮显示 THEN 系统 SHALL 将[取消]和[确认退回]按钮居中显示
5. WHEN 审核人未输入退回原因 THEN 系统 SHALL 阻止退回操作并提示"请输入退回原因"
6. WHEN 审核人确认退回 THEN 系统 SHALL 将报价单状态更改为"已退回"
7. WHEN 报价单被退回 THEN 系统 SHALL 记录退回原因、审核人ID和审核时间

### 需求 6：已审核详情页面

**用户故事：** 作为审核人或管理员，我希望能够查看已审核报价单的详情和审核结果。

#### 验收标准

1. WHEN 审核人打开已审核详情页面 THEN 系统 SHALL 以弹窗形式显示，右上角有X关闭按钮和导出按钮
2. WHEN 审核人查看报价单摘要 THEN 系统 SHALL 显示基本信息（客户名称、客户地区、销售类型、法规类别、产品型号、订单数量、包装配置）和价格信息（成本价格、管销价格、最终价格、利润报价）
3. WHEN 审核人查看审核结果 THEN 系统 SHALL 显示审核状态（通过/退回）和审核时间（右下角显示）
4. WHEN 审核人查看审核结果 THEN 系统 SHALL 不显示审核人姓名，不显示审核时间
5. WHEN 审核人查看审核批注 THEN 系统 SHALL 显示审核批注内容
6. WHEN 审核人查看成本构成 THEN 系统 SHALL 显示原料成本、工序成本、包材成本、运费成本的金额和占比
7. WHEN 审核人查看审核历史 THEN 系统 SHALL 显示完整的审核流程时间线（创建→提交→审核通过/退回）

### 需求 7：业务员查看退回报价单

**用户故事：** 作为业务员，我希望能够查看被退回的报价单及退回原因，以便了解问题并进行修改。

#### 验收标准

1. WHEN 业务员打开已退回报价单 THEN 系统 SHALL 以弹窗形式显示，右上角有X关闭按钮、[编辑]和[重新提交]按钮
2. WHEN 业务员查看退回通知 THEN 系统 SHALL 在页面顶部醒目显示退回原因
3. WHEN 业务员查看基本信息 THEN 系统 SHALL 显示报价单基本信息（同审核详情页）
4. WHEN 业务员查看审核历史 THEN 系统 SHALL 显示完整的审核流程时间线（创建→提交→退回→当前待修改）

### 需求 8：业务员编辑退回报价单

**用户故事：** 作为业务员，我希望能够编辑被退回的报价单，以便修正问题后重新提交。

#### 验收标准

1. WHEN 业务员点击[编辑]按钮 THEN 系统 SHALL 打开报价单编辑页面
2. WHEN 编辑页面显示 THEN 系统 SHALL 在顶部显示退回原因提示
3. WHEN 业务员编辑成本明细 THEN 系统 SHALL 允许修改用量字段
4. WHEN 业务员编辑成本明细 THEN 系统 SHALL 将单价字段设为只读（从原料管理自动获取）
5. WHEN 业务员需要添加原料 THEN 系统 SHALL 在成本明细区域显眼位置提供[+ 添加原料]按钮
6. WHEN 业务员修改数据 THEN 系统 SHALL 实时计算并显示价格汇总（成本价、管销价、外销价、利润报价）
7. WHEN 业务员点击[保存草稿] THEN 系统 SHALL 保存修改但不改变状态
8. WHEN 业务员点击[保存并提交] THEN 系统 SHALL 弹出重新提交确认弹窗

### 需求 9：重新提交确认

**用户故事：** 作为业务员，我希望在重新提交前确认报价单信息，以避免误操作。

#### 验收标准

1. WHEN 重新提交确认弹窗显示 THEN 系统 SHALL 显示客户名称、产品型号、订单数量、最终价格、利润区间报价
2. WHEN 重新提交确认弹窗按钮显示 THEN 系统 SHALL 将[取消]和[确认提交]按钮居中显示
3. WHEN 业务员确认提交 THEN 系统 SHALL 将报价单状态从"已退回"更改为"已提交"
4. WHEN 报价单重新提交 THEN 系统 SHALL 保留完整的审核历史链

### 需求 10：业务员查看审核通过的报价单

**用户故事：** 作为业务员，我希望能够查看审核通过的报价单详情，以便了解最终报价信息。

#### 验收标准

1. WHEN 业务员打开已通过报价单 THEN 系统 SHALL 以弹窗形式显示，右上角有X关闭按钮和导出按钮
2. WHEN 业务员查看报价单摘要 THEN 系统 SHALL 显示基本信息和报价信息（最终价格+利润档位报价表）
3. WHEN 业务员查看审核结果 THEN 系统 SHALL 显示"恭喜！该报价单已审核通过"及审核时间
4. WHEN 业务员查看审核批注 THEN 系统 SHALL 显示审核批注内容
5. WHEN 业务员查看审核流程 THEN 系统 SHALL 显示完整的审核流程时间线
6. WHEN 业务员查看已通过报价单 THEN 系统 SHALL 不显示复制按钮（已移除）

### 需求 11：侧边栏菜单结构

**用户故事：** 作为用户，我希望能够通过清晰的菜单结构访问审核相关功能。

#### 验收标准

1. WHEN 系统显示侧边栏菜单 THEN 系统 SHALL 将"成本管理"和"审核管理"作为独立的菜单组
2. WHEN 用户展开"成本管理"菜单 THEN 系统 SHALL 显示：新增报价、标准成本、成本记录
3. WHEN 用户展开"审核管理"菜单 THEN 系统 SHALL 显示：待审核记录、已审核记录
4. WHEN 业务员或只读用户登录 THEN 系统 SHALL 隐藏"审核管理"菜单组
5. WHEN 审核人或管理员登录 THEN 系统 SHALL 显示"审核管理"菜单组

### 需求 12：页面访问权限控制

**用户故事：** 作为系统管理员，我希望不同角色看到不同的页面内容，以确保数据安全和操作权限。

#### 验收标准

1. WHEN 管理员访问待审核记录 THEN 系统 SHALL 显示审核和删除按钮
2. WHEN 审核人访问待审核记录 THEN 系统 SHALL 显示审核按钮，隐藏删除按钮
3. WHEN 业务员或只读用户访问待审核记录 THEN 系统 SHALL 拒绝访问并重定向
4. WHEN 管理员或审核人查看报价单详情 THEN 系统 SHALL 显示完整成本明细视图
5. WHEN 业务员查看报价单详情 THEN 系统 SHALL 显示简略视图（审核结果+摘要+成本构成比例）
6. WHEN 只读用户查看报价单详情 THEN 系统 SHALL 显示简略视图且无操作按钮

### 需求 13：UI规范

**用户故事：** 作为开发人员，我需要遵循统一的UI规范，以确保界面一致性。

#### 验收标准

1. WHEN 显示基本信息栏位 THEN 系统 SHALL 使用4字符对齐的栏位名称（如：客户名称、客户地区、销售类型、产品型号、订单数量、审核状态、创建人员、成本价格、管销价格、最终价格）
2. WHEN 显示数量字段 THEN 系统 SHALL 附带单位（PCS或箱）
3. WHEN 显示审核历史时间线 THEN 系统 SHALL 使用完整日期格式（YYYY-MM-DD HH:mm）
4. WHEN 显示差异高亮 THEN 系统 SHALL 使用规定的颜色规范（一致:白色、修改:浅蓝#E6F7FF、新增:浅绿#F6FFED、删除:浅红#FFF1F0）
5. WHEN 显示状态标签 THEN 系统 SHALL 使用规定的颜色（草稿:灰色、已提交:黄色、已通过:绿色、已退回:红色）
6. WHEN 弹窗页面显示 THEN 系统 SHALL 在右上角显示X关闭按钮，不显示"返回列表"链接
