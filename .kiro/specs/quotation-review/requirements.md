# 报价单审核流程 - 需求文档

## 项目简介

本功能旨在补全成本分析管理系统的审核流程，实现报价单的状态流转、差异高亮、批注功能和审核记录追溯。系统已预留数据库字段和基础API，本次开发将完成前端审核页面和后端审核逻辑的完整实现。

## 术语表

- **报价单(Quotation)**：业务员创建的成本报价记录
- **审核人(Reviewer)**：具有审核权限的用户角色
- **差异高亮(Difference Highlight)**：标记业务员修改过的数据项
- **批注(Comment)**：审核人对报价单添加的备注信息
- **标准配置(Standard Config)**：包装配置关联的标准原料、工序、包材数据

## 需求列表

### 需求 1：审核列表页面

**用户故事：** 作为审核人，我希望能够查看所有待审核的报价单列表，以便快速了解审核工作量并选择报价单进行审核。

#### 验收标准

1. WHEN 审核人访问审核管理页面 THEN 系统 SHALL 显示所有状态为"已提交"的报价单列表
2. WHEN 审核人查看列表 THEN 系统 SHALL 显示报价单编号、客户名称、型号、创建人、提交时间
3. WHEN 审核人点击筛选 THEN 系统 SHALL 支持按客户名称、型号、提交日期范围筛选
4. WHEN 审核人点击排序 THEN 系统 SHALL 支持按提交时间升序/降序排列
5. WHEN 列表数据超过20条 THEN 系统 SHALL 提供分页功能
6. WHEN 审核人点击报价单行 THEN 系统 SHALL 跳转到审核详情页面

### 需求 2：审核详情与差异对比

**用户故事：** 作为审核人，我希望能够查看报价单详情并清晰看到业务员修改的内容，以便准确判断报价是否合理。

#### 验收标准

1. WHEN 审核人打开报价单详情 THEN 系统 SHALL 显示完整的报价单信息（客户、型号、数量、价格明细）
2. WHEN 报价单明细项被业务员修改过 THEN 系统 SHALL 使用浅蓝色背景高亮显示该行
3. WHEN 审核人查看修改项 THEN 系统 SHALL 显示原始值和修改后的值对比
4. WHEN 报价单关联标准配置 THEN 系统 SHALL 显示标准配置数据与实际使用数据的对比视图
5. WHEN 审核人查看对比视图 THEN 系统 SHALL 分别显示原料、工序、包材三个分类的对比
6. WHEN 存在差异项 THEN 系统 SHALL 在对比视图中用颜色区分（新增项绿色、删除项红色、修改项蓝色）

### 需求 3：审核操作（通过/退回）

**用户故事：** 作为审核人，我希望能够对报价单执行通过或退回操作，以便完成审核流程并通知业务员结果。

#### 验收标准

1. WHEN 审核人点击"通过"按钮 THEN 系统 SHALL 将报价单状态更改为"已审核"
2. WHEN 报价单审核通过 THEN 系统 SHALL 记录审核人ID和审核时间
3. WHEN 报价单审核通过 THEN 系统 SHALL 在列表中显示绿色状态标签
4. WHEN 审核人点击"退回"按钮 THEN 系统 SHALL 弹出退回原因输入框
5. WHEN 审核人未输入退回原因 THEN 系统 SHALL 阻止退回操作并提示"请输入退回原因"
6. WHEN 审核人输入退回原因并确认 THEN 系统 SHALL 将报价单状态更改为"已退回"
7. WHEN 报价单被退回 THEN 系统 SHALL 记录退回原因、审核人ID和审核时间
8. WHEN 报价单被退回 THEN 系统 SHALL 在列表中显示红色状态标签

### 需求 4：批注功能

**用户故事：** 作为审核人，我希望能够对报价单添加批注，以便记录审核意见或与业务员沟通问题。

#### 验收标准

1. WHEN 审核人点击"添加批注"按钮 THEN 系统 SHALL 显示批注输入框
2. WHEN 审核人输入批注内容并提交 THEN 系统 SHALL 保存批注到数据库
3. WHEN 批注保存成功 THEN 系统 SHALL 在报价单详情页显示批注列表
4. WHEN 显示批注列表 THEN 系统 SHALL 显示批注内容、批注人姓名、批注时间
5. WHEN 报价单有批注 THEN 系统 SHALL 在列表页显示批注图标标记
6. WHEN 业务员查看被退回的报价单 THEN 系统 SHALL 显示所有批注内容

### 需求 5：审核历史记录

**用户故事：** 作为管理员或审核人，我希望能够查看报价单的审核历史，以便追溯审核过程和责任。

#### 验收标准

1. WHEN 用户查看报价单详情 THEN 系统 SHALL 显示审核历史时间线
2. WHEN 显示审核历史 THEN 系统 SHALL 包含状态变更记录（创建、提交、通过/退回）
3. WHEN 显示审核历史 THEN 系统 SHALL 显示每次状态变更的操作人和时间
4. IF 报价单被退回后重新提交 THEN 系统 SHALL 保留完整的审核历史链
5. WHEN 管理员查询审核统计 THEN 系统 SHALL 提供审核人的审核数量和平均审核时长

### 需求 6：业务员退回处理

**用户故事：** 作为业务员，我希望能够查看被退回的报价单及退回原因，以便修改后重新提交。

#### 验收标准

1. WHEN 业务员访问成本记录页面 THEN 系统 SHALL 在"已退回"状态的报价单上显示红色标签
2. WHEN 业务员点击已退回的报价单 THEN 系统 SHALL 显示退回原因和审核人批注
3. WHEN 业务员编辑已退回的报价单 THEN 系统 SHALL 允许修改报价单内容
4. WHEN 业务员重新提交报价单 THEN 系统 SHALL 将状态从"已退回"更改为"已提交"
5. WHEN 报价单重新提交 THEN 系统 SHALL 清除之前的退回原因但保留批注历史

### 需求 7：审核通知（可选）

**用户故事：** 作为业务员，我希望在报价单审核完成后收到通知，以便及时了解审核结果。

#### 验收标准

1. WHEN 报价单审核通过 THEN 系统 SHALL 在业务员的仪表盘显示通知消息
2. WHEN 报价单被退回 THEN 系统 SHALL 在业务员的仪表盘显示通知消息
3. WHEN 用户点击通知 THEN 系统 SHALL 跳转到对应的报价单详情页
4. WHEN 用户查看通知后 THEN 系统 SHALL 标记该通知为已读
