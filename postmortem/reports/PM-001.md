# PM-001: Git合并时代码被覆盖

## 元信息
- **ID**: PM-001
- **修复Commit**: da1bec4, c099cb4, 44bc5c9
- **影响范围**: 前端页面组件
- **根因类别**: `STATE_MGMT`

## 问题描述
在进行 Git 合并操作时，本地开发的页面代码被远程版本覆盖，导致已实现的功能丢失（如客户归属业务员功能、CostPageHeader 统一组件等）。

## 根因分析
- **直接原因**: Git merge 时选择了错误的合并策略或未仔细处理冲突
- **深层原因**: 
  1. 缺乏合并前的代码对比流程
  2. 多人协作时未建立明确的分支管理规范
  3. 合并后未进行功能回归测试
- **涉及文件**: 
  - `frontend/src/views/customer/CustomerManage.vue`
  - `frontend/src/views/cost/CostAdd.vue`
  - `frontend/src/views/packaging/PackagingManage.vue`
  - `frontend/src/views/process/ProcessManage.vue`

## 触发条件 ⚠️ 关键
```yaml
patterns:
  - type: scenario
    description: "执行 git merge 或 git pull 后，特别是涉及前端 views 目录的大量变更"
  - type: code_pattern
    regex: "\\+.*deletions\\(-\\)|files changed.*insertions.*deletions"
    description: "commit 中出现大量删除行数，可能是代码被覆盖"
  - type: keyword
    words: ["恢复", "restore", "revert", "被覆盖", "merge conflict"]
```

## 修复方案
1. 恢复被覆盖的代码版本
2. 统一使用 CostPageHeader 组件
3. 建立合并前 diff 检查流程

## 预防检查清单
- [ ] 合并前执行 `git diff origin/main` 查看差异
- [ ] 大量删除行数的 commit 需要人工复核
- [ ] 合并后运行前端功能回归测试
- [ ] 保持分支小而频繁地合并

## 相关问题
- 模式: STATE_MGMT - 版本控制状态管理
