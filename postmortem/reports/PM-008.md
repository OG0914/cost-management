# PM-008: 依赖包高危漏洞(xlsx)

## 元信息
- **ID**: PM-008
- **修复Commit**: 64c1999
- **影响范围**: 后端 Excel 处理
- **根因类别**: `DEPENDENCY`

## 问题描述
后端使用的 `xlsx` 包存在高危安全漏洞，可能导致 RCE (远程代码执行)。

## 根因分析
- **直接原因**: xlsx 包版本过低，存在已知漏洞
- **深层原因**: 
  1. 缺少定期的依赖安全审计
  2. package.json 使用 ^ 版本号，但未及时更新
  3. 无 CI 自动安全扫描
- **涉及文件**: 
  - `backend/package.json`
  - `backend/controllers/materialController.js`
  - `backend/controllers/processController.js`
  - `backend/utils/excelParser.js`
  - `backend/utils/excelGenerator.js`

## 触发条件 ⚠️ 关键
```yaml
patterns:
  - type: code_pattern
    regex: "\"xlsx\":\\s*\"[^\"]+\""
    description: "使用 xlsx 包需检查版本安全性"
  - type: code_pattern
    regex: "require\\(['\"]xlsx['\"]\\)|from ['\"]xlsx['\"]"
    description: "引入 xlsx 包的代码"
  - type: scenario
    description: "添加新依赖时需执行 npm audit"
  - type: keyword
    words: ["xlsx", "exceljs", "sheetjs", "npm audit", "vulnerability"]
```

## 修复方案
将 xlsx 替换为更安全的 exceljs：
```bash
npm uninstall xlsx
npm install exceljs
```
更新所有 Excel 处理代码使用 exceljs API。

## 预防检查清单
- [ ] 定期执行 `npm audit` 检查漏洞
- [ ] CI/CD 集成安全扫描（如 Snyk）
- [ ] 新增依赖前检查安全评级
- [ ] 高危漏洞必须在 24h 内修复

## 相关问题
- 模式: DEPENDENCY - 依赖安全
