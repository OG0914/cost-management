# PM-009: 复制报价单时包材明细名称丢失

## 元信息
- **ID**: PM-009
- **修复Commit**: 40e3213
- **影响范围**: 报价单复制功能
- **根因类别**: `STATE_MGMT`

## 问题描述
复制报价单时，包材明细中的物料名称无法带出，显示为空或 undefined。

## 根因分析
- **直接原因**: 复制逻辑只复制了 ID，未关联查询名称
- **深层原因**: 
  1. 复制时使用浅拷贝，关联数据丢失
  2. 前端显示依赖实时查询，复制后查询失败
  3. 数据结构设计不规范，名称应冗余存储
- **涉及文件**: 
  - `frontend/src/views/cost/CostAdd.vue`
  - `frontend/src/views/packaging/PackagingManage.vue`

## 触发条件 ⚠️ 关键
```yaml
patterns:
  - type: code_pattern
    regex: "JSON\\.parse\\(JSON\\.stringify|Object\\.assign\\(\\{\\}|\\.\\.\\."
    description: "浅拷贝操作可能丢失关联数据"
  - type: code_pattern
    regex: "copy|clone|duplicate|复制"
    description: "复制功能需检查关联数据完整性"
  - type: scenario
    description: "复制功能实现时，需列出所有关联字段并逐一验证"
  - type: keyword
    words: ["复制", "copy", "clone", "带出", "关联", "名称丢失"]
```

## 修复方案
1. 复制时同时复制名称等冗余字段：
```javascript
const copiedItem = {
  ...originalItem,
  material_name: originalItem.material?.name || '',
  // 不只复制 material_id
};
```
2. 或在复制后重新查询关联数据

## 预防检查清单
- [ ] 复制功能必须列出完整字段清单
- [ ] 测试复制后所有字段的显示正确性
- [ ] 关联数据考虑冗余存储以提高稳定性
- [ ] 复制操作后执行数据完整性校验

## 相关问题
- 模式: STATE_MGMT - 数据复制完整性
